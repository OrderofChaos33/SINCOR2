<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ company_name }} - Business Intelligence Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">{{ company_name }}</h1>
                    <p class="text-gray-600">{{ industry|title }} Business Intelligence</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-500">{{ current_date }}</p>
                    <p class="text-xs text-green-600">üü¢ All Systems Operational</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6">

        <!-- Demo Data Notice -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
            <div class="flex items-center">
                <div class="text-yellow-600 mr-3">‚ö†Ô∏è</div>
                <div>
                    <h3 class="text-sm font-semibold text-yellow-800">Demo Data Display</h3>
                    <p class="text-xs text-yellow-700 mt-1">
                        This dashboard shows sample data to demonstrate SINCOR's capabilities. 
                        <a href="#setup" class="underline font-medium">Connect your systems below</a> to see real business data.
                    </p>
                </div>
            </div>
        </div>

        <!-- Today's Performance -->
        <div class="mb-8">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">üìä Today's Performance</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">

                <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                    <h3 class="text-xs font-semibold text-gray-600 uppercase">New Leads</h3>
                    <p class="text-2xl font-bold text-blue-600">{{ metrics.new_leads_today }}</p>
                    <p class="text-xs text-gray-500">+3 from yesterday</p>
                </div>

                <div class="bg-white p-4 rounded-lg shadow border-l-4 border-green-500">
                    <h3 class="text-xs font-semibold text-gray-600 uppercase">Appointments</h3>
                    <p class="text-2xl font-bold text-green-600">{{ metrics.appointments_scheduled }}</p>
                    <p class="text-xs text-gray-500">Scheduled today</p>
                </div>

                <div class="bg-white p-4 rounded-lg shadow border-l-4 border-purple-500">
                    <h3 class="text-xs font-semibold text-gray-600 uppercase">Completion Rate</h3>
                    <p class="text-2xl font-bold text-purple-600">{{ metrics.completion_rate }}%</p>
                    <p class="text-xs text-gray-500">This week</p>
                </div>

                <div class="bg-white p-4 rounded-lg shadow border-l-4 border-yellow-500">
                    <h3 class="text-xs font-semibold text-gray-600 uppercase">Rating</h3>
                    <p class="text-2xl font-bold text-yellow-600">{{ metrics.customer_satisfaction }}/5.0</p>
                    <p class="text-xs text-gray-500">Avg customer rating</p>
                </div>

                <div class="bg-white p-4 rounded-lg shadow border-l-4 border-emerald-500">
                    <h3 class="text-xs font-semibold text-gray-600 uppercase">Revenue Today</h3>
                    <p class="text-2xl font-bold text-emerald-600">{{ metrics.revenue_today }}</p>
                    <p class="text-xs text-gray-500">Completed services</p>
                </div>

            </div>
        </div>

        <!-- Business Metrics -->
        <div class="mb-8">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">üìà Business Metrics</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold text-gray-800 mb-4">Monthly Performance</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Vehicles Completed:</span>
                            <span class="font-semibold text-gray-800">{{ industry_metrics.vehicles_completed }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Monthly Revenue:</span>
                            <span class="font-semibold text-green-600">{{ industry_metrics.monthly_revenue }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Avg Service Value:</span>
                            <span class="font-semibold text-blue-600">{{ industry_metrics.avg_service_value }}</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold text-gray-800 mb-4">Customer Intelligence</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Booking Conversion:</span>
                            <span class="font-semibold text-purple-600">{{ industry_metrics.booking_conversion }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Repeat Customers:</span>
                            <span class="font-semibold text-indigo-600">{{ industry_metrics.repeat_customers }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Next Available:</span>
                            <span class="font-semibold text-orange-600">{{ industry_metrics.next_available }}</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold text-gray-800 mb-4">AI Agent Network</h3>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600 mb-2">{{ agents.coordination_score }}/100</div>
                        <p class="text-gray-600">System Performance</p>
                        <div class="mt-4 p-3 bg-green-50 rounded-lg">
                            <p class="text-sm text-green-700">‚úÖ All {{ agents.active_count }} agents operational</p>
                            <p class="text-xs text-green-600 mt-1">Lead generation, booking, follow-up active</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Action Center -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">üéØ Working Business Tools</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

                <button onclick="generateLeads()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-4 rounded-lg font-semibold transition-colors">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üéØ</div>
                        <div>Generate Leads</div>
                        <div class="text-xs opacity-75">Find local customers NOW</div>
                    </div>
                </button>

                <button onclick="createCampaign()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-4 rounded-lg font-semibold transition-colors">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üì¢</div>
                        <div>Launch Campaign</div>
                        <div class="text-xs opacity-75">Automated marketing</div>
                    </div>
                </button>

                <button onclick="analyzeOpportunities()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-4 rounded-lg font-semibold transition-colors">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üí°</div>
                        <div>Find Opportunities</div>
                        <div class="text-xs opacity-75">Growth analysis</div>
                    </div>
                </button>

            </div>
            
            <!-- Results Display -->
            <div id="results-display" class="mt-6 hidden">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <div class="text-green-600 mr-3">‚úÖ</div>
                        <div>
                            <h3 id="results-title" class="text-sm font-semibold text-green-800">Action Completed</h3>
                            <p id="results-message" class="text-xs text-green-700 mt-1"></p>
                        </div>
                    </div>
                    <div id="results-details" class="mt-3 text-xs text-green-700"></div>
                </div>
            </div>
        </div>

        <!-- Under the Hood -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">üîß Under the Hood</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <div>
                    <h3 class="font-medium text-gray-700 mb-3">Active AI Agents</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Lead Generation Agent:</span>
                            <span class="text-green-600">üü¢ Active</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Booking Automation:</span>
                            <span class="text-green-600">üü¢ Processing 3 requests</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Follow-up Sequences:</span>
                            <span class="text-green-600">üü¢ 12 scheduled</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Review Management:</span>
                            <span class="text-green-600">üü¢ Monitoring</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="font-medium text-gray-700 mb-3">System Status</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>API Connections:</span>
                            <span class="text-green-600">‚úÖ All connected</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Data Sync:</span>
                            <span class="text-green-600">‚úÖ Real-time</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Last Update:</span>
                            <span class="text-gray-600">2 minutes ago</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Uptime:</span>
                            <span class="text-green-600">99.7% (30 days)</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Agent Configuration -->
        <div class="mt-8 bg-purple-50 border border-purple-200 rounded-lg p-6">
            <h2 class="text-lg font-semibold text-purple-800 mb-4">ü§ñ Configure Your AI Agents</h2>
            <p class="text-sm text-purple-700 mb-4">Select individual agents and dial their capabilities up or down based on your needs:</p>
            
            <div class="text-center mb-6">
                <a href="/agent-setup" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-lg font-bold text-lg inline-block">
                    üéØ Select & Configure Individual Agents
                </a>
                <p class="text-xs text-purple-600 mt-2">Choose from 42 specialized AI agents with adjustable capability levels</p>
            </div>
        </div>

        <!-- Data Integration Setup -->
        <div id="setup" class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
            <h2 class="text-lg font-semibold text-blue-800 mb-4">üîó Connect Your Real Data</h2>
            <p class="text-sm text-blue-700 mb-4">Replace demo data with live metrics from your business systems:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded border">
                    <h3 class="font-medium text-gray-800 mb-2">üìÖ Google Calendar</h3>
                    <p class="text-xs text-gray-600 mb-3">Sync appointments with Google Calendar for real scheduling</p>
                    <button onclick="connectCalendar()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">Connect Calendar</button>
                    <div id="calendar-status" class="mt-2 text-xs hidden"></div>
                </div>
                
                <div class="bg-white p-4 rounded border">
                    <h3 class="font-medium text-gray-800 mb-2">üí∞ Stripe Payments</h3>
                    <p class="text-xs text-gray-600 mb-3">Process real credit card payments and invoicing</p>
                    <button onclick="connectPayments()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">Connect Stripe</button>
                    <div id="payments-status" class="mt-2 text-xs hidden"></div>
                </div>
                
                <div class="bg-white p-4 rounded border">
                    <h3 class="font-medium text-gray-800 mb-2">üìß Email Automation</h3>
                    <p class="text-xs text-gray-600 mb-3">Send real follow-up emails and review requests</p>
                    <button onclick="connectEmail()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">Setup Email</button>
                    <div id="email-status" class="mt-2 text-xs hidden"></div>
                </div>
                
                <div class="bg-white p-4 rounded border">
                    <h3 class="font-medium text-gray-800 mb-2">üì± SMS Automation</h3>
                    <p class="text-xs text-gray-600 mb-3">Send appointment reminders and follow-ups via SMS</p>
                    <button onclick="connectSMS()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">Setup SMS</button>
                    <div id="sms-status" class="mt-2 text-xs hidden"></div>
                </div>
            </div>
            
            <div class="mt-4 p-3 bg-blue-100 rounded">
                <p class="text-xs text-blue-800">
                    <strong>Free Trial Includes:</strong> All integrations, unlimited data connections, and 42 AI agents working with your real business data.
                </p>
            </div>
        </div>

    </div>

    <script>
        // Working business automation functions
        
        function generateLeads() {
            const button = event.target.closest('button');
            button.disabled = true;
            button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">‚è≥</div><div>Generating...</div></div>';
            
            fetch('/generate-leads', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.engine === "Real Business Intelligence") {
                    showResults('üöÄ Real Lead Engine Active!', 
                        `Engine: ${data.engine} | Location: ${data.location}`,
                        `‚úÖ Found: ${data.businesses_found} businesses | üìä Saved: ${data.businesses_saved} | üéØ High-Value: ${data.high_value_prospects}`);
                } else if (data.setup_required) {
                    showError('‚öôÔ∏è Setup Required', data.message + ' - Google Places API key needed');
                } else if (data.success) {
                    showResults('Leads Generated!', data.message, 
                        `Found: ${data.leads.map(l => l.customer.name + ' - ' + l.customer.value).join(', ')}`);
                } else {
                    showError('Lead Generation Failed', data.error);
                }
                button.disabled = false;
                button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">üéØ</div><div>Generate Leads</div><div class="text-xs opacity-75">Find local customers NOW</div></div>';
            })
            .catch(error => {
                showError('Error', error.message);
                button.disabled = false;
                button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">üéØ</div><div>Generate Leads</div><div class="text-xs opacity-75">Find local customers NOW</div></div>';
            });
        }
        
        function createCampaign() {
            const button = event.target.closest('button');
            button.disabled = true;
            button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">‚è≥</div><div>Creating...</div></div>';
            
            fetch('/create-campaign', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: 'local_seo'})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.engine === "Real Campaign Automation") {
                    showResults('üöÄ Real Campaign Engine Active!', 
                        `Engine: ${data.engine} | Campaign: ${data.campaign_name}`,
                        `‚úÖ Campaign ID: ${data.campaign_id} | üéØ Target: ${data.target_type} | Status: ${data.status}`);
                } else if (data.setup_required) {
                    showError('‚öôÔ∏è Setup Required', data.message + ' - Email configuration needed');
                } else if (data.success) {
                    showResults('Campaign Created!', data.message, 
                        `Actions: ${data.campaign.actions.join(' ‚Ä¢ ')}`);
                } else {
                    showError('Campaign Failed', data.error);
                }
                button.disabled = false;
                button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">üì¢</div><div>Launch Campaign</div><div class="text-xs opacity-75">Automated marketing</div></div>';
            })
            .catch(error => {
                showError('Error', error.message);
                button.disabled = false;
                button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">üì¢</div><div>Launch Campaign</div><div class="text-xs opacity-75">Automated marketing</div></div>';
            });
        }
        
        function analyzeOpportunities() {
            const button = event.target.closest('button');
            button.disabled = true;
            button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">‚è≥</div><div>Analyzing...</div></div>';
            
            fetch('/analyze-opportunities', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResults('Opportunities Found!', data.message,
                        `Top: ${data.opportunities[0].title} - ${data.opportunities[0].potential_revenue}`);
                } else {
                    showError('Analysis Failed', data.error);
                }
                button.disabled = false;
                button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">üí°</div><div>Find Opportunities</div><div class="text-xs opacity-75">Growth analysis</div></div>';
            })
            .catch(error => {
                showError('Error', error.message);
                button.disabled = false;
                button.innerHTML = '<div class="text-center"><div class="text-2xl mb-2">üí°</div><div>Find Opportunities</div><div class="text-xs opacity-75">Growth analysis</div></div>';
            });
        }
        
        function showResults(title, message, details) {
            document.getElementById('results-title').textContent = title;
            document.getElementById('results-message').textContent = message;
            document.getElementById('results-details').textContent = details;
            document.getElementById('results-display').classList.remove('hidden');
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                document.getElementById('results-display').classList.add('hidden');
            }, 10000);
        }
        
        function showError(title, message) {
            const resultsDiv = document.getElementById('results-display');
            resultsDiv.innerHTML = `
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <div class="text-red-600 mr-3">‚ùå</div>
                        <div>
                            <h3 class="text-sm font-semibold text-red-800">${title}</h3>
                            <p class="text-xs text-red-700 mt-1">${message}</p>
                        </div>
                    </div>
                </div>
            `;
            resultsDiv.classList.remove('hidden');
            
            setTimeout(() => {
                resultsDiv.classList.add('hidden');
            }, 5000);
        }
        
        function openCortexChat() {
            const currentDomain = window.location.hostname;
            let cortexUrl;
            
            if (currentDomain === 'localhost' || currentDomain === '127.0.0.1') {
                cortexUrl = 'http://localhost:5001/admin/chat';
            } else {
                cortexUrl = `https://${currentDomain}/cortex/chat`;
            }
            
            window.open(cortexUrl, '_blank', 'width=1200,height=800');
        }

        // Real Integration Functions
        function connectCalendar() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Connecting...';
            
            fetch('/connect-calendar', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('calendar-status');
                statusDiv.classList.remove('hidden');
                
                if (data.success && data.connected) {
                    statusDiv.innerHTML = `<span class="text-green-700">‚úÖ Connected to ${data.calendar_name}</span>`;
                    button.textContent = 'Connected';
                    button.className = 'bg-green-600 text-white px-3 py-1 rounded text-xs';
                } else if (data.auth_url) {
                    statusDiv.innerHTML = `<a href="${data.auth_url}" target="_blank" class="text-blue-700 underline">Click here to authorize Google Calendar</a>`;
                    button.textContent = 'Authorize';
                    button.disabled = false;
                }
            })
            .catch(error => {
                console.error('Calendar connection error:', error);
                button.disabled = false;
                button.textContent = 'Connect Calendar';
            });
        }

        function connectPayments() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Connecting...';
            
            fetch('/connect-payments', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('payments-status');
                statusDiv.classList.remove('hidden');
                
                if (data.success && data.connected) {
                    statusDiv.innerHTML = `<span class="text-green-700">‚úÖ Connected to Stripe - ${data.recent_payments}</span>`;
                    button.textContent = 'Connected';
                    button.className = 'bg-green-600 text-white px-3 py-1 rounded text-xs';
                } else if (data.stripe_signup_url) {
                    statusDiv.innerHTML = `<a href="${data.stripe_signup_url}" target="_blank" class="text-blue-700 underline">Sign up for Stripe account</a>`;
                    button.textContent = 'Sign Up';
                    button.disabled = false;
                }
            })
            .catch(error => {
                console.error('Payments connection error:', error);
                button.disabled = false;
                button.textContent = 'Connect Stripe';
            });
        }

        function connectEmail() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Setting up...';
            
            fetch('/connect-email', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('email-status');
                statusDiv.classList.remove('hidden');
                
                if (data.success && data.setup_options) {
                    statusDiv.innerHTML = `
                        <div class="text-blue-700">
                            <p class="font-semibold">Setup Steps for Gmail:</p>
                            <ol class="text-xs mt-1">
                                ${data.setup_options[0].setup_steps.map((step, i) => `<li>${i+1}. ${step}</li>`).join('')}
                            </ol>
                            <button onclick="testEmail()" class="mt-2 bg-green-600 text-white px-2 py-1 rounded text-xs">Test Email</button>
                        </div>
                    `;
                    button.textContent = 'Setup Instructions Shown';
                    button.className = 'bg-yellow-600 text-white px-3 py-1 rounded text-xs';
                }
                button.disabled = false;
            })
            .catch(error => {
                console.error('Email setup error:', error);
                button.disabled = false;
                button.textContent = 'Setup Email';
            });
        }

        function connectSMS() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Setting up...';
            
            fetch('/connect-sms', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('sms-status');
                statusDiv.classList.remove('hidden');
                
                if (data.success && data.twilio_signup_url) {
                    statusDiv.innerHTML = `
                        <div class="text-blue-700">
                            <p class="font-semibold">Twilio SMS Setup:</p>
                            <p class="text-xs mt-1">${data.pricing}</p>
                            <a href="${data.twilio_signup_url}" target="_blank" class="text-blue-700 underline text-xs">Sign up for Twilio</a>
                        </div>
                    `;
                    button.textContent = 'Signup Link Provided';
                    button.className = 'bg-yellow-600 text-white px-3 py-1 rounded text-xs';
                }
                button.disabled = false;
            })
            .catch(error => {
                console.error('SMS setup error:', error);
                button.disabled = false;
                button.textContent = 'Setup SMS';
            });
        }

        function testEmail() {
            const email = prompt('Enter your email to test:');
            if (!email) return;
            
            fetch('/test-email', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email: email})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.email_sent) {
                    alert(`‚úÖ Test email sent successfully to ${email}!`);
                } else if (data.setup_available) {
                    alert('üìß Email system ready for setup. Configure your SMTP credentials first.');
                } else {
                    alert(`‚ùå Email failed: ${data.error}`);
                }
            })
            .catch(error => {
                alert(`‚ùå Error: ${error.message}`);
            });
        }
    </script>

</body>
</html>