<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINCOR Agent Observability</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 212, 255, 0.2);
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .panel-full { grid-column: span 12; }
        .panel-half { grid-column: span 6; }
        .panel-third { grid-column: span 4; }
        .panel-two-thirds { grid-column: span 8; }

        @media (max-width: 768px) {
            .panel-half, .panel-third, .panel-two-thirds {
                grid-column: span 12;
            }
        }

        .panel h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #00d4ff;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .agent-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .agent-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .agent-card:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            transform: translateY(-2px);
        }

        .agent-card.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
        }

        .agent-name {
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 5px;
        }

        .agent-archetype {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .agent-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .status-active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .status-idle {
            background: rgba(255, 200, 0, 0.2);
            color: #ffc800;
        }

        .status-error {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        #interaction-graph {
            width: 100%;
            height: 500px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .task-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-id {
            font-family: monospace;
            color: #00d4ff;
            font-size: 0.9em;
        }

        .task-status {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .status-completed {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .status-in_progress {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .status-failed {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .status-pending {
            background: rgba(255, 200, 0, 0.2);
            color: #ffc800;
        }

        .task-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.4);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            font-size: 1em;
            cursor: pointer;
        }

        .filter-select option {
            background: #1a1a2e;
            color: white;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: rgba(255, 255, 255, 0.7);
        }

        .metric-value {
            font-weight: bold;
            color: #00d4ff;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.5);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .health-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .health-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffc800, #00ff88);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🤖 SINCOR Agent Observability</h1>
        <p>Real-time agent monitoring, analytics, and interaction visualization</p>
    </div>

    <!-- Key Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Active Agents</div>
            <div class="stat-value" id="stat-active-agents">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Tasks</div>
            <div class="stat-value" id="stat-total-tasks">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Success Rate</div>
            <div class="stat-value" id="stat-success-rate">--%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Avg Response Time</div>
            <div class="stat-value" id="stat-avg-response">--ms</div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard-grid">
        <!-- Agent List -->
        <div class="panel panel-third">
            <h2>🎯 Active Agents</h2>
            <div class="controls">
                <select class="filter-select" id="archetype-filter">
                    <option value="">All Archetypes</option>
                    <option value="Scout">Scout</option>
                    <option value="Synthesizer">Synthesizer</option>
                    <option value="Builder">Builder</option>
                    <option value="Negotiator">Negotiator</option>
                    <option value="Caretaker">Caretaker</option>
                    <option value="Auditor">Auditor</option>
                    <option value="Director">Director</option>
                </select>
            </div>
            <div class="agent-list" id="agent-list"></div>
        </div>

        <!-- Agent Details -->
        <div class="panel panel-two-thirds">
            <h2>📊 Agent Performance</h2>
            <div id="agent-details">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Select an agent to view details</p>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="performance-chart"></canvas>
            </div>
        </div>

        <!-- Interaction Graph -->
        <div class="panel panel-full">
            <h2>🔗 Agent Interaction Network</h2>
            <div id="interaction-graph"></div>
        </div>

        <!-- Recent Tasks -->
        <div class="panel panel-half">
            <h2>📋 Recent Tasks</h2>
            <div class="controls">
                <select class="filter-select" id="task-status-filter">
                    <option value="">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="in_progress">In Progress</option>
                    <option value="completed">Completed</option>
                    <option value="failed">Failed</option>
                </select>
                <button class="refresh-btn" onclick="refreshTasks()">Refresh</button>
            </div>
            <div class="task-list" id="task-list"></div>
        </div>

        <!-- Activity Timeline -->
        <div class="panel panel-half">
            <h2>📈 Activity Timeline (24h)</h2>
            <div class="chart-container">
                <canvas id="timeline-chart"></canvas>
            </div>
        </div>

        <!-- Archetype Summary -->
        <div class="panel panel-full">
            <h2>🏛️ Performance by Archetype</h2>
            <div class="chart-container">
                <canvas id="archetype-chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let selectedAgent = null;
        let performanceChart = null;
        let timelineChart = null;
        let archetypeChart = null;

        // Initialize dashboard
        async function initDashboard() {
            await loadAgentSummary();
            await loadActivityTimeline();
            await loadArchetypeSummary();
            await loadInteractionGraph();
            await loadRecentTasks();

            // Auto-refresh every 10 seconds
            setInterval(() => {
                loadAgentSummary();
                if (selectedAgent) {
                    loadAgentDetails(selectedAgent);
                }
            }, 10000);
        }

        // Load agent summary
        async function loadAgentSummary() {
            try {
                const response = await fetch('/api/agent-analytics/agent-summary');
                const data = await response.json();

                if (data.success) {
                    const agents = data.agents;

                    // Update stats
                    document.getElementById('stat-active-agents').textContent = agents.length;

                    const totalTasks = agents.reduce((sum, a) => sum + (a.tasks_completed + a.tasks_failed), 0);
                    document.getElementById('stat-total-tasks').textContent = totalTasks;

                    const avgSuccess = agents.reduce((sum, a) => sum + a.success_rate, 0) / Math.max(agents.length, 1);
                    document.getElementById('stat-success-rate').textContent = avgSuccess.toFixed(1) + '%';

                    const avgResponse = agents.reduce((sum, a) => sum + a.avg_response_time, 0) / Math.max(agents.length, 1);
                    document.getElementById('stat-avg-response').textContent = Math.round(avgResponse) + 'ms';

                    // Render agent list
                    renderAgentList(agents);
                }
            } catch (error) {
                console.error('Error loading agent summary:', error);
            }
        }

        // Render agent list
        function renderAgentList(agents) {
            const listEl = document.getElementById('agent-list');
            const filter = document.getElementById('archetype-filter').value;

            const filteredAgents = filter ? agents.filter(a => a.archetype === filter) : agents;

            listEl.innerHTML = filteredAgents.map(agent => `
                <div class="agent-card ${selectedAgent === agent.agent_id ? 'active' : ''}"
                     onclick="selectAgent('${agent.agent_id}')">
                    <div class="agent-name">${agent.agent_name}</div>
                    <div class="agent-archetype">${agent.archetype}</div>
                    <span class="agent-status status-${agent.status}">${agent.status.toUpperCase()}</span>
                    <div class="health-bar">
                        <div class="health-bar-fill" style="width: ${agent.health_score}%"></div>
                    </div>
                </div>
            `).join('');
        }

        // Select agent
        async function selectAgent(agentId) {
            selectedAgent = agentId;
            await loadAgentDetails(agentId);
            await loadAgentSummary(); // Refresh to update active state
        }

        // Load agent details
        async function loadAgentDetails(agentId) {
            try {
                const [metricsRes, analyticsRes] = await Promise.all([
                    fetch(`/api/agent-analytics/metrics?agent_id=${agentId}&limit=50`),
                    fetch(`/api/agent-analytics/analytics?agent_id=${agentId}`)
                ]);

                const metricsData = await metricsRes.json();
                const analyticsData = await analyticsRes.json();

                if (metricsData.success && analyticsData.success) {
                    renderAgentDetails(metricsData.metrics[0], analyticsData.analytics);
                    renderPerformanceChart(metricsData.metrics);
                }
            } catch (error) {
                console.error('Error loading agent details:', error);
            }
        }

        // Render agent details
        function renderAgentDetails(metric, analytics) {
            const detailsEl = document.getElementById('agent-details');
            detailsEl.innerHTML = `
                <div class="metric-row">
                    <span class="metric-label">Agent Name:</span>
                    <span class="metric-value">${metric.agent_name}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Archetype:</span>
                    <span class="metric-value">${metric.archetype}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Tasks Completed:</span>
                    <span class="metric-value">${analytics.completed_tasks}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Success Rate:</span>
                    <span class="metric-value">${analytics.success_rate.toFixed(1)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Avg Duration:</span>
                    <span class="metric-value">${analytics.avg_duration_ms.toFixed(0)}ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Quality Score:</span>
                    <span class="metric-value">${analytics.avg_quality_score.toFixed(1)}/100</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Health Score:</span>
                    <span class="metric-value">${metric.health_score.toFixed(1)}/100</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Continuity Index:</span>
                    <span class="metric-value">${metric.continuity_index.toFixed(3)}</span>
                </div>
            `;
        }

        // Render performance chart
        function renderPerformanceChart(metrics) {
            const ctx = document.getElementById('performance-chart');

            if (performanceChart) {
                performanceChart.destroy();
            }

            const labels = metrics.reverse().map(m => new Date(m.timestamp).toLocaleTimeString());
            const successRates = metrics.map(m => m.success_rate);
            const qualityScores = metrics.map(m => m.quality_score);

            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Success Rate (%)',
                        data: successRates,
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Quality Score',
                        data: qualityScores,
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        // Load activity timeline
        async function loadActivityTimeline() {
            try {
                const response = await fetch('/api/agent-analytics/activity-timeline?hours=24');
                const data = await response.json();

                if (data.success) {
                    renderTimelineChart(data.timeline);
                }
            } catch (error) {
                console.error('Error loading timeline:', error);
            }
        }

        // Render timeline chart
        function renderTimelineChart(timeline) {
            const ctx = document.getElementById('timeline-chart');

            if (timelineChart) {
                timelineChart.destroy();
            }

            const labels = timeline.map(t => new Date(t.timestamp).toLocaleString());
            const completed = timeline.map(t => t.completed_tasks);
            const failed = timeline.map(t => t.failed_tasks);

            timelineChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completed',
                        data: completed,
                        backgroundColor: 'rgba(0, 255, 136, 0.6)',
                        borderColor: '#00ff88',
                        borderWidth: 1
                    }, {
                        label: 'Failed',
                        data: failed,
                        backgroundColor: 'rgba(255, 68, 68, 0.6)',
                        borderColor: '#ff4444',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            stacked: true,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            stacked: true,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        // Load archetype summary
        async function loadArchetypeSummary() {
            try {
                const response = await fetch('/api/agent-analytics/archetype-summary');
                const data = await response.json();

                if (data.success) {
                    renderArchetypeChart(data.archetypes);
                }
            } catch (error) {
                console.error('Error loading archetype summary:', error);
            }
        }

        // Render archetype chart
        function renderArchetypeChart(archetypes) {
            const ctx = document.getElementById('archetype-chart');

            if (archetypeChart) {
                archetypeChart.destroy();
            }

            const labels = archetypes.map(a => a.archetype);
            const successRates = archetypes.map(a => a.avg_success_rate);
            const qualityScores = archetypes.map(a => a.avg_quality_score);
            const healthScores = archetypes.map(a => a.avg_health_score);

            archetypeChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Success Rate',
                        data: successRates,
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.2)'
                    }, {
                        label: 'Quality Score',
                        data: qualityScores,
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.2)'
                    }, {
                        label: 'Health Score',
                        data: healthScores,
                        borderColor: '#ffc800',
                        backgroundColor: 'rgba(255, 200, 0, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        r: {
                            ticks: { color: '#fff', backdropColor: 'transparent' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: { color: '#fff' }
                        }
                    }
                }
            });
        }

        // Load interaction graph (placeholder - would need D3.js force graph)
        async function loadInteractionGraph() {
            try {
                const response = await fetch('/api/agent-analytics/interaction-graph?limit=100');
                const data = await response.json();

                if (data.success) {
                    renderInteractionGraph(data.nodes, data.edges);
                }
            } catch (error) {
                console.error('Error loading interaction graph:', error);
            }
        }

        // Render interaction graph with D3.js
        function renderInteractionGraph(nodes, edges) {
            const container = document.getElementById('interaction-graph');
            container.innerHTML = '';

            if (nodes.length === 0) {
                container.innerHTML = '<div class="loading"><p>No interactions yet</p></div>';
                return;
            }

            const width = container.offsetWidth;
            const height = 500;

            const svg = d3.select('#interaction-graph')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(edges).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2));

            const link = svg.append('g')
                .selectAll('line')
                .data(edges)
                .enter().append('line')
                .attr('stroke', '#00d4ff')
                .attr('stroke-opacity', 0.6)
                .attr('stroke-width', 2);

            const node = svg.append('g')
                .selectAll('circle')
                .data(nodes)
                .enter().append('circle')
                .attr('r', d => 5 + (d.interactions / 2))
                .attr('fill', '#00ff88')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            const label = svg.append('g')
                .selectAll('text')
                .data(nodes)
                .enter().append('text')
                .text(d => d.name)
                .attr('font-size', 10)
                .attr('fill', '#fff')
                .attr('dx', 15)
                .attr('dy', 4);

            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);

                label
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }

        // Load recent tasks
        async function loadRecentTasks() {
            try {
                const status = document.getElementById('task-status-filter').value;
                const url = `/api/agent-analytics/tasks?limit=20${status ? '&status=' + status : ''}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.success) {
                    renderTaskList(data.tasks);
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }

        // Render task list
        function renderTaskList(tasks) {
            const listEl = document.getElementById('task-list');

            if (tasks.length === 0) {
                listEl.innerHTML = '<div class="loading"><p>No tasks found</p></div>';
                return;
            }

            listEl.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-header">
                        <span class="task-id">${task.task_id}</span>
                        <span class="task-status status-${task.status}">${task.status.toUpperCase()}</span>
                    </div>
                    <div class="task-description">
                        <strong>${task.agent_name}</strong> (${task.archetype})<br>
                        ${task.task_description}
                    </div>
                </div>
            `).join('');
        }

        // Refresh tasks
        function refreshTasks() {
            loadRecentTasks();
        }

        // Event listeners
        document.getElementById('archetype-filter').addEventListener('change', loadAgentSummary);
        document.getElementById('task-status-filter').addEventListener('change', loadRecentTasks);

        // Initialize
        initDashboard();
    </script>
</body>
</html>
