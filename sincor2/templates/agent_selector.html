<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINCOR Agent Control Center</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">SINCOR Agent Control Center</h1>
                    <p class="text-gray-600">Select and configure your AI business automation agents</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-blue-600">🤖 42 Agents Available</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6">

        <!-- Recommendations -->
        <div class="mb-8">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                <h2 class="text-lg font-semibold text-blue-800 mb-4">🎯 Recommended for Your Business</h2>
                <p class="text-sm text-blue-700 mb-4">Based on your auto detailing business profile, we recommend starting with these agents:</p>
                
                <div id="recommendations" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Recommendations will be loaded here -->
                </div>
                
                <div class="mt-4">
                    <button onclick="acceptRecommendations()" class="bg-blue-600 text-white px-6 py-2 rounded font-semibold hover:bg-blue-700">
                        ✅ Accept Recommendations & Start Setup
                    </button>
                    <button onclick="showAllAgents()" class="ml-4 bg-gray-200 text-gray-700 px-6 py-2 rounded font-semibold hover:bg-gray-300">
                        👀 Browse All 42 Agents
                    </button>
                </div>
            </div>
        </div>

        <!-- All Agents (Hidden by default) -->
        <div id="all-agents" class="hidden mb-8">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">🤖 All SINCOR Agents</h2>
            
            <!-- Agent Categories -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <button onclick="filterCategory('all')" class="category-filter bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium">All Agents</button>
                    <button onclick="filterCategory('Marketing & Sales')" class="category-filter bg-gray-200 text-gray-700 px-4 py-2 rounded text-sm font-medium">Marketing & Sales</button>
                    <button onclick="filterCategory('Operations')" class="category-filter bg-gray-200 text-gray-700 px-4 py-2 rounded text-sm font-medium">Operations</button>
                    <button onclick="filterCategory('Customer Relations')" class="category-filter bg-gray-200 text-gray-700 px-4 py-2 rounded text-sm font-medium">Customer Relations</button>
                    <button onclick="filterCategory('Finance')" class="category-filter bg-gray-200 text-gray-700 px-4 py-2 rounded text-sm font-medium">Finance</button>
                </div>
            </div>
            
            <div id="agent-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- All agents will be loaded here -->
            </div>
        </div>

        <!-- Selected Agents -->
        <div id="selected-agents" class="mb-8 hidden">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">🎯 Your Selected Agents</h2>
            <div id="selected-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Selected agents will appear here -->
            </div>
            
            <div class="mt-6 text-center">
                <button onclick="startOnboarding()" class="bg-green-600 text-white px-8 py-3 rounded-lg font-bold text-lg hover:bg-green-700">
                    🚀 Start Agent Setup & Onboarding
                </button>
                <p class="text-sm text-gray-600 mt-2">Estimated setup time: <span id="setup-time">15-30 minutes</span></p>
            </div>
        </div>

        <!-- Onboarding Flow (Hidden by default) -->
        <div id="onboarding-flow" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">🚀 Agent Setup & Onboarding</h2>
                
                <!-- Progress Bar -->
                <div class="mb-8">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>Progress</span>
                        <span id="progress-text">0/3 Phases Complete</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Current Step -->
                <div id="current-step" class="border rounded-lg p-6">
                    <!-- Step content will be loaded here -->
                </div>
                
                <!-- Navigation -->
                <div class="mt-6 flex justify-between">
                    <button id="prev-btn" onclick="previousStep()" class="bg-gray-200 text-gray-700 px-6 py-2 rounded font-semibold hover:bg-gray-300" disabled>
                        ← Previous
                    </button>
                    <button id="next-btn" onclick="nextStep()" class="bg-blue-600 text-white px-6 py-2 rounded font-semibold hover:bg-blue-700">
                        Next →
                    </button>
                </div>
            </div>
        </div>

        <!-- Success Screen -->
        <div id="setup-complete" class="hidden text-center py-12">
            <div class="bg-green-50 border border-green-200 rounded-lg p-8 max-w-2xl mx-auto">
                <div class="text-6xl mb-4">🎉</div>
                <h2 class="text-2xl font-bold text-green-800 mb-4">Agent Setup Complete!</h2>
                <p class="text-green-700 mb-6">Your SINCOR agents are now active and working for your business.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white p-4 rounded border">
                        <div class="text-2xl mb-2">🎯</div>
                        <p class="font-semibold">Leads</p>
                        <p class="text-sm text-gray-600">Generating now</p>
                    </div>
                    <div class="bg-white p-4 rounded border">
                        <div class="text-2xl mb-2">📅</div>
                        <p class="font-semibold">Scheduling</p>
                        <p class="text-sm text-gray-600">Automated</p>
                    </div>
                    <div class="bg-white p-4 rounded border">
                        <div class="text-2xl mb-2">💬</div>
                        <p class="font-semibold">Follow-up</p>
                        <p class="text-sm text-gray-600">Active</p>
                    </div>
                </div>
                
                <a href="/admin" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold inline-block hover:bg-blue-700">
                    → Go to Dashboard
                </a>
            </div>
        </div>

    </div>

    <script>
        let selectedAgents = new Set();
        let currentOnboardingStep = 0;
        let onboardingPlan = {};

        // Load recommendations on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadRecommendations();
        });

        function loadRecommendations() {
            fetch('/get-agent-recommendations', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                displayRecommendations(data.recommendations);
            })
            .catch(error => console.error('Error loading recommendations:', error));
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendations');
            container.innerHTML = '';
            
            recommendations.forEach(rec => {
                const agent = getAgentInfo(rec.agent_id);
                const card = createAgentCard(agent, rec, true);
                container.appendChild(card);
            });
        }

        function createAgentCard(agent, recommendation = null, isRecommended = false) {
            const div = document.createElement('div');
            div.className = `bg-white p-4 rounded-lg border ${selectedAgents.has(agent.id) ? 'border-blue-500 bg-blue-50' : 'border-gray-200'} cursor-pointer hover:border-blue-300`;
            div.onclick = () => toggleAgent(agent.id, div);
            
            const priorityBadge = recommendation ? 
                `<span class="inline-block px-2 py-1 text-xs font-semibold bg-${recommendation.priority.toLowerCase() === 'high' ? 'red' : 'yellow'}-100 text-${recommendation.priority.toLowerCase() === 'high' ? 'red' : 'yellow'}-800 rounded">${recommendation.priority} Priority</span>` : '';
            
            div.innerHTML = `
                <div class="flex items-start justify-between mb-2">
                    <div class="flex items-center">
                        <div class="text-2xl mr-3">${agent.icon}</div>
                        <div>
                            <h3 class="font-semibold text-gray-800">${agent.name}</h3>
                            <p class="text-sm text-gray-600">${agent.category}</p>
                        </div>
                    </div>
                    ${priorityBadge}
                </div>
                <p class="text-sm text-gray-700 mb-3">${agent.description}</p>
                ${recommendation ? `<p class="text-xs text-blue-700 font-medium">${recommendation.reason}</p>` : ''}
                ${recommendation ? `<p class="text-xs text-green-700 mt-1">${recommendation.estimated_roi}</p>` : ''}
                
                <div class="mt-3">
                    <label class="text-xs text-gray-600">Capability Level:</label>
                    <div class="flex gap-1 mt-1">
                        <button onclick="event.stopPropagation(); setAgentLevel('${agent.id}', 1)" class="level-btn text-xs px-2 py-1 rounded ${getAgentLevel(agent.id) === 1 ? 'bg-blue-600 text-white' : 'bg-gray-200'}">Basic</button>
                        <button onclick="event.stopPropagation(); setAgentLevel('${agent.id}', 2)" class="level-btn text-xs px-2 py-1 rounded ${getAgentLevel(agent.id) === 2 ? 'bg-blue-600 text-white' : 'bg-gray-200'}">Advanced</button>
                        <button onclick="event.stopPropagation(); setAgentLevel('${agent.id}', 3)" class="level-btn text-xs px-2 py-1 rounded ${getAgentLevel(agent.id) === 3 ? 'bg-blue-600 text-white' : 'bg-gray-200'}">Expert</button>
                    </div>
                </div>
            `;
            
            return div;
        }

        function getAgentInfo(agentId) {
            // This would normally come from the server, but for demo purposes:
            const agents = {
                'lead_generation': {id: 'lead_generation', name: 'Lead Generation Agent', description: 'Finds and qualifies potential customers', category: 'Marketing & Sales', icon: '🎯'},
                'appointment_scheduler': {id: 'appointment_scheduler', name: 'Appointment Scheduling Agent', description: 'Automatically schedules appointments', category: 'Operations', icon: '📅'},
                'customer_follow_up': {id: 'customer_follow_up', name: 'Customer Follow-up Agent', description: 'Follows up with customers for reviews', category: 'Customer Relations', icon: '💬'},
                'payment_processor': {id: 'payment_processor', name: 'Payment Processing Agent', description: 'Handles invoicing and payments', category: 'Finance', icon: '💳'},
                'social_media_manager': {id: 'social_media_manager', name: 'Social Media Manager Agent', description: 'Manages your social media presence', category: 'Marketing & Sales', icon: '📱'},
                'reputation_manager': {id: 'reputation_manager', name: 'Reputation Management Agent', description: 'Monitors and manages your reputation', category: 'Customer Relations', icon: '⭐'}
            };
            return agents[agentId] || {id: agentId, name: 'Unknown Agent', description: '', category: 'Other', icon: '🤖'};
        }

        let agentLevels = {};

        function getAgentLevel(agentId) {
            return agentLevels[agentId] || 2; // Default to Advanced
        }

        function setAgentLevel(agentId, level) {
            agentLevels[agentId] = level;
            // Update the UI to reflect the change
        }

        function toggleAgent(agentId, cardElement) {
            if (selectedAgents.has(agentId)) {
                selectedAgents.delete(agentId);
                cardElement.className = cardElement.className.replace('border-blue-500 bg-blue-50', 'border-gray-200');
            } else {
                selectedAgents.add(agentId);
                cardElement.className = cardElement.className.replace('border-gray-200', 'border-blue-500 bg-blue-50');
            }
            
            updateSelectedDisplay();
        }

        function updateSelectedDisplay() {
            const container = document.getElementById('selected-agents');
            const listContainer = document.getElementById('selected-list');
            
            if (selectedAgents.size > 0) {
                container.classList.remove('hidden');
                
                listContainer.innerHTML = '';
                selectedAgents.forEach(agentId => {
                    const agent = getAgentInfo(agentId);
                    const level = getAgentLevel(agentId);
                    const levelNames = ['', 'Basic', 'Advanced', 'Expert'];
                    
                    const div = document.createElement('div');
                    div.className = 'bg-white p-4 rounded-lg border border-blue-200';
                    div.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">${agent.icon}</div>
                                <div>
                                    <h4 class="font-semibold">${agent.name}</h4>
                                    <p class="text-sm text-gray-600">${levelNames[level]} Level</p>
                                </div>
                            </div>
                            <button onclick="removeAgent('${agentId}')" class="text-red-600 hover:text-red-800">✕</button>
                        </div>
                    `;
                    listContainer.appendChild(div);
                });
                
                // Update setup time estimate
                document.getElementById('setup-time').textContent = `${selectedAgents.size * 10}-${selectedAgents.size * 20} minutes`;
            } else {
                container.classList.add('hidden');
            }
        }

        function removeAgent(agentId) {
            selectedAgents.delete(agentId);
            updateSelectedDisplay();
        }

        function acceptRecommendations() {
            // Auto-select recommended agents
            selectedAgents.add('lead_generation');
            selectedAgents.add('appointment_scheduler');
            selectedAgents.add('customer_follow_up');
            
            updateSelectedDisplay();
            
            // Scroll to selected agents
            document.getElementById('selected-agents').scrollIntoView({behavior: 'smooth'});
        }

        function showAllAgents() {
            document.getElementById('all-agents').classList.remove('hidden');
            loadAllAgents();
        }

        function loadAllAgents() {
            // This would load all 42 agents from the server
            // For now, just showing the main ones
            const agentIds = ['lead_generation', 'appointment_scheduler', 'customer_follow_up', 'payment_processor', 'social_media_manager', 'reputation_manager'];
            const container = document.getElementById('agent-grid');
            
            container.innerHTML = '';
            agentIds.forEach(agentId => {
                const agent = getAgentInfo(agentId);
                const card = createAgentCard(agent);
                container.appendChild(card);
            });
        }

        function startOnboarding() {
            if (selectedAgents.size === 0) {
                alert('Please select at least one agent to continue.');
                return;
            }
            
            // Hide other sections
            document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
            document.getElementById('onboarding-flow').classList.remove('hidden');
            
            // Create onboarding plan
            createOnboardingPlan();
        }

        function createOnboardingPlan() {
            // This would normally call the server
            onboardingPlan = {
                phases: [
                    {
                        phase: 1,
                        name: "Quick Setup",
                        agents: Array.from(selectedAgents).slice(0, 2),
                        steps: ["Connect accounts", "Set preferences", "Test functionality"]
                    },
                    {
                        phase: 2, 
                        name: "Configuration",
                        agents: Array.from(selectedAgents).slice(2),
                        steps: ["Advanced settings", "Automation rules", "Performance tuning"]
                    },
                    {
                        phase: 3,
                        name: "Activation",
                        agents: Array.from(selectedAgents),
                        steps: ["Final testing", "Go live", "Monitor results"]
                    }
                ]
            };
            
            currentOnboardingStep = 0;
            showOnboardingStep();
        }

        function showOnboardingStep() {
            const phase = onboardingPlan.phases[currentOnboardingStep];
            const stepContainer = document.getElementById('current-step');
            
            stepContainer.innerHTML = `
                <h3 class="text-xl font-semibold mb-4">Phase ${phase.phase}: ${phase.name}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${phase.agents.map(agentId => {
                        const agent = getAgentInfo(agentId);
                        return `
                            <div class="border rounded p-4">
                                <div class="flex items-center mb-2">
                                    <div class="text-xl mr-2">${agent.icon}</div>
                                    <h4 class="font-semibold">${agent.name}</h4>
                                </div>
                                <div class="space-y-2">
                                    ${phase.steps.map(step => `
                                        <label class="flex items-center text-sm">
                                            <input type="checkbox" class="mr-2">
                                            ${step}
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <div class="mt-6 p-4 bg-blue-50 rounded">
                    <p class="text-sm text-blue-800">
                        <strong>Next Steps:</strong> Complete the setup tasks above, then click Next to continue.
                    </p>
                </div>
            `;
            
            // Update progress
            const progress = ((currentOnboardingStep + 1) / onboardingPlan.phases.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `${currentOnboardingStep + 1}/${onboardingPlan.phases.length} Phases Complete`;
            
            // Update navigation
            document.getElementById('prev-btn').disabled = currentOnboardingStep === 0;
            document.getElementById('next-btn').textContent = currentOnboardingStep === onboardingPlan.phases.length - 1 ? 'Complete Setup' : 'Next →';
        }

        function nextStep() {
            if (currentOnboardingStep < onboardingPlan.phases.length - 1) {
                currentOnboardingStep++;
                showOnboardingStep();
            } else {
                completeSetup();
            }
        }

        function previousStep() {
            if (currentOnboardingStep > 0) {
                currentOnboardingStep--;
                showOnboardingStep();
            }
        }

        function completeSetup() {
            // Hide onboarding flow
            document.getElementById('onboarding-flow').classList.add('hidden');
            document.getElementById('setup-complete').classList.remove('hidden');
            
            // Save configuration to server
            saveAgentConfiguration();
        }

        function saveAgentConfiguration() {
            const config = {
                selected_agents: Array.from(selectedAgents),
                agent_levels: agentLevels,
                setup_completed: true,
                setup_date: new Date().toISOString()
            };
            
            fetch('/save-agent-config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Configuration saved:', data);
            })
            .catch(error => console.error('Error saving configuration:', error));
        }
    </script>

</body>
</html>